<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Color Extractor</title>
<script src="https://threejs.org/build/three.js"></script>
</head>
<body>
<input type="file" id="videoUpload" accept="video/*">
<video id="videoPlayer" width="320" height="240" style="display:none;" autoplay></video>
<div id="canvasContainer"></div>
<script>
    var scene, camera, renderer, sphere;
    var videoElement, canvas, ctx;
    var clock = new THREE.Clock();
    var color = new THREE.Color();

    init();
    animate();

    function init() {
        scene = new THREE.Scene();
        camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.z = 2;

        renderer = new THREE.WebGLRenderer();
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        var geometry = new THREE.SphereGeometry(1, 32, 32);
        var material = new THREE.MeshBasicMaterial({color: 0xffffff});
        sphere = new THREE.Mesh(geometry, material);
        scene.add(sphere);

        videoElement = document.getElementById('videoPlayer');
        canvas = document.createElement('canvas');
        ctx = canvas.getContext('2d');

        document.getElementById('videoUpload').addEventListener('change', function(e) {
            var file = e.target.files[0];
            var url = URL.createObjectURL(file);
            videoElement.src = url;
            videoElement.play();
            clock.start();
        });

        videoElement.addEventListener('play', function() {
            canvas.width = videoElement.videoWidth;
            canvas.height = videoElement.videoHeight;
        });
    }

    function animate() {
        requestAnimationFrame(animate);
        ctx.drawImage(videoElement, 0, 0, canvas.width, canvas.height);
        var frame = ctx.getImageData(0, 0, canvas.width, canvas.height).data;
        var r = 0, g = 0, b = 0;
        for (var i = 0; i < frame.length; i += 4) {
            r += frame[i];
            g += frame[i+1];
            b += frame[i+2];
        }
        r /= (canvas.width * canvas.height);
        g /= (canvas.width * canvas.height);
        b /= (canvas.width * canvas.height);
        color.setRGB(r/255, g/255, b/255);
        sphere.material.color = color;

        if (clock.getElapsedTime() > 30) {
            scene.remove(sphere);
            clock.stop();
            clock.elapsedTime = 0;
            document.getElementById('videoUpload').value = '';
            var geometry = new THREE.SphereGeometry(1, 32, 32);
            var material = new THREE.MeshBasicMaterial({color: 0xffffff});
            sphere = new THREE.Mesh(geometry, material);
            scene.add(sphere);
        }
        renderer.render(scene, camera);
    }
</script>
</body>
</html>